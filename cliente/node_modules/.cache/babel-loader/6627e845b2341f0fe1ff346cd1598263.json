{"ast":null,"code":"var _jsxFileName = \"/Users/Angelota/Library/Mobile Documents/com~apple~CloudDocs/Desktop/UCM/TFG INFOR/TFG FINAL/TFGI-Plataforma-blockchain-para-visualizar-la-reputacion-de-empresas-sobre-casos-de-discriminacion/cliente/src/views/pages/formulario/form.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext, useEffect } from \"react\";\nimport { context } from '../../../contextProvider.js';\nimport Web3 from 'web3';\nimport ReputationControl from '../../../ReputationControl.json';\nimport { useForm } from 'react-hook-form';\nimport * as data from './constantData';\nimport swal from 'sweetalert';\nimport Swal from 'sweetalert2';\nimport axios from 'axios';\nimport { create as ipfsHttpClient } from \"ipfs-http-client\";\nimport { Box, Button, Typography } from '@mui/material';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogContentText from '@mui/material/DialogContentText';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst client = ipfsHttpClient(\"https://ipfs.infura.io:5001/api/v0\");\n\nconst Formulario = () => {\n  _s();\n\n  const {\n    handleSubmit,\n    register,\n    formState: {\n      errors,\n      isSubmitting,\n      isSubmitSuccessful\n    }\n  } = useForm();\n  const [companies, setCompanies] = useState([]);\n  const [open, setOpen] = useState(true);\n  const Context = React.useContext(context);\n  let hash = \"\";\n  useEffect(() => {\n    Context.contract.methods.getCompaniesNames().call().then(response => setCompanies(response));\n  }, []);\n\n  const handleClickOpen = () => {\n    setOpen(true);\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n  }; //Obtener la fecha actual\n\n\n  function formatoFecha(fecha, formato) {\n    const map = {\n      dd: fecha.getDate(),\n      mm: fecha.getMonth() + 1,\n      yy: fecha.getFullYear().toString().slice(-2),\n      yyyy: fecha.getFullYear()\n    };\n    return formato.replace(/dd|mm|yy|yyy/gi, matched => map[matched]);\n  } //Función para realizar la transaccion al recibir los parametros\n\n\n  async function newComplaint(transaction) {\n    const tx = {\n      to: process.env.REACT_APP_CONTRACT_ADDRESS,\n      //Dirección del contrato\n      data: transaction.encodeABI(),\n      //\n      gas: await transaction.estimateGas({\n        from: process.env.REACT_APP_ADDRESS\n      }),\n      //Se estima el coste en gas\n      gasPrice: await Context.web3.eth.getGasPrice(),\n      //Precio del gas\n      gaslimit: 0x1000000,\n      //Limite de gas que se puede gastar\n      value: 0 //No se va a realizar una transferencia\n\n    };\n    console.log(\"transacción construida\"); //Se firma la transacción con la clave privada\n\n    const signedTx = await Context.web3.eth.accounts.signTransaction(tx, process.env.REACT_APP_ETH_PRIVATE_KEY);\n    console.log(\"transacción firmada\"); //Se envia la transaccion firmada \n\n    await Context.web3.eth.sendSignedTransaction(signedTx.rawTransaction);\n  }\n\n  const submitForm = async (data, e) => {\n    e.preventDefault(); //Comprobar que el usuario esta conectado a linkedin\n\n    if (!Context.user) {\n      console.log(\"El usuario no está conectado\");\n      swal({\n        title: \"ERROR\",\n        text: \"¡Debes estar conectado para enviar una denuncia!\",\n        icon: \"error\",\n        button: \"Aceptar\"\n      });\n    } else {\n      //Obtener fecha\n      const fecha = new Date();\n      fecha.toLocaleDateString();\n      const date = formatoFecha(fecha, 'dd/mm/yy');\n      Swal.fire({\n        title: 'La denuncia está siendo cargada en la blockchain',\n        timer: 1000000,\n        timerProgressBar: false,\n        didOpen: () => {\n          Swal.showLoading();\n        }\n      }); //Añadir datos a la bbdd para graficas generales\n\n      let gender = data.gender.toLowerCase();\n      if (gender == \"hombre\" || gender == \"masculino\") gender = \"masculino\";else if (gender == \"mujer\" || gender == \"femenino\") gender = \"femenino\";else if (gender == \"\") gender = \"prefiero no responder\";else gender = \"otro\"; //Faltaria comprobar que en el genero se cometan errores ortograficos\n\n      let age = parseInt(data.age);\n      let rangeAge;\n      if (Number.isNaN(data.age)) rangeAge = \"prefiero no responder\";else if (age >= 81) rangeAge = \"más de 80\";else if (age >= 71) rangeAge = \"71-80\";else if (age >= 61) rangeAge = \"61-70\";else if (age >= 51) rangeAge = \"51-60\";else if (age >= 41) rangeAge = \"41-50\";else if (age >= 31) rangeAge = \"31-40\";else if (age >= 21) rangeAge = \"21-30\";else rangeAge = \"16-21\";\n      console.log(data.relation);\n      let complaintJson = {\n        \"text\": data.text,\n        \"date\": date,\n        \"type\": data.type.toLowerCase(),\n        \"etnia\": data.etnia,\n        \"gender\": gender,\n        \"age\": rangeAge,\n        \"relation\": data.relation.toLowerCase(),\n        \"previousComplaints\": data.previousComplaints !== null ? data.previousComplaints : \"-\",\n        \"media\": data.media\n      };\n      hash = await client.add(JSON.stringify(complaintJson)); //Relizar la denuncia\n\n      try {\n        await newComplaint(Context.contract.methods.newComplaint(data.company, hash.path));\n        let complaintBBDD = {\n          \"type\": data.type.toLowerCase(),\n          \"gender\": gender,\n          \"age\": rangeAge,\n          \"relation\": data.relation.toLowerCase()\n        }; //Enviar datos de denuncia a BBDD para gráficas\n\n        axios.post(`${process.env.REACT_APP_SERVER_URL}/charts`, complaintBBDD, {\n          withCredentials: true\n        });\n        Swal.fire({\n          title: \"Denuncia cargada\",\n          text: \"La denuncia ya ha sido registrada en la blockchain\",\n          icon: \"success\",\n          timer: \"10000\"\n        }).then(function () {\n          //Volver a la pagina principal\n          window.location.href = `http://localhost:3000`;\n        });\n      } catch (err) {\n        console.log(err.message);\n        swal({\n          title: \"ERROR\",\n          text: \"Algo ha ido mal a la hora de subir la denuncia a la blockchain. Vuelva a intentarlo más tarde\",\n          icon: \"error\",\n          button: \"Aceptar\"\n        });\n      } //Restaurar estado del formulario\n\n\n      e.target.reset();\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Dialog, {\n      open: open,\n      onClose: handleClose,\n      \"aria-labelledby\": \"alert-dialog-title\",\n      \"aria-describedby\": \"alert-dialog-description\",\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        id: \"alert-dialog-title\",\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h3\",\n          children: \"Formulario de denuncia\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: /*#__PURE__*/_jsxDEV(DialogContentText, {\n          id: \"alert-dialog-description\",\n          children: /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h5\",\n            children: \"Recuerde que todos los datos inclu\\xEDdos se almacenan en la blockchain y en IPFS, un sistema de ficheros descentralizado. Por tanto, son de caracter p\\xFAblico. Debe seleccionar obligatoriamente la empresa, su situaci\\xF3n actual con dicha compa\\xF1\\xEDa, el tipo de denunc\\xEDa y la descripci\\xF3n del suceso. Es libre de introducir el resto de datos que considere oportuno. Adem\\xE1s, se utilizar\\xE1n para elaborar las gr\\xE1ficas de la aplicaci\\xF3n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleClose,\n          autoFocus: true,\n          children: \"Ok\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"ui form\",\n      onSubmit: handleSubmit(submitForm),\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"ui dividing header\",\n        children: \"Formulario de Denuncia\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"field\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"two fields\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"required field\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"Nombre de la empresa\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"ui fluid selection dropdown\",\n              ...register(\"company\", {\n                validate: value => value !== \"Seleccione la empresa\"\n              }),\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                hidden: true,\n                children: \"Seleccione la empresa\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 15\n              }, this), companies.map(item => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: item,\n                children: item\n              }, item, false, {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 38\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 11\n            }, this), errors.company && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ui negative message\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"header\",\n                children: \"Debe seleccionar la empresa\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 236,\n              columnNumber: 30\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"required field\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"Relaci\\xF3n actual con la empresa\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 243,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"ui fluid selection dropdown\",\n              ...register(\"relation\", {\n                validate: value => value !== \"Seleccione la relación actual con la empresa\"\n              }),\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                hidden: true,\n                children: \"Seleccione la relaci\\xF3n actual con la empresa\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 15\n              }, this), data.relations.map(item => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: item,\n                children: item\n              }, item, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 43\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 11\n            }, this), errors.relation && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ui negative message\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"header\",\n                children: \"Debe seleccionar la relaci\\xF3n actual con la empresa\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 31\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"three fields\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inline fields\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"\\xBFHas denunciado anteriormente?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"field\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ui radio checkbox\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"radio\",\n                ...register(\"previousComplaints\"),\n                value: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"S\\xED\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 13\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"field\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ui radio checkbox\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"radio\",\n                ...register(\"previousComplaints\"),\n                value: false\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 276,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"No\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 280,\n                columnNumber: 13\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"field\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Medio\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ...register(\"media\"),\n            placeholder: \"En caso afirmativo, \\xBFmediante qu\\xE9 medio?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"field\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Fecha aproximada del suceso o del inicio de este\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 296,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"two fields\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"field\",\n              children: /*#__PURE__*/_jsxDEV(\"select\", {\n                className: \"ui fluid search dropdown\",\n                ...register(\"month\"),\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  hidden: true,\n                  children: \"Seleccione el mes\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 302,\n                  columnNumber: 15\n                }, this), data.months.map(item => /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: item,\n                  children: item\n                }, item, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 303,\n                  columnNumber: 40\n                }, this))]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 299,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"field\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                ...register('year', {\n                  valueAsNumber: true,\n                  maxLength: 4,\n                  minLength: 4\n                }),\n                placeholder: \"A\\xF1o\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 308,\n                columnNumber: 11\n              }, this), errors.year && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ui negative message\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"header\",\n                  children: \" Debe escribir correctamente el a\\xF1o\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 317,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 316,\n                columnNumber: 27\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"field\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"required field\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Tipo de denuncia\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            className: \"ui fluid dropdown\",\n            ...register('type', {\n              validate: value => value !== \"Seleccione el tipo de denuncia\"\n            }),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              hidden: true,\n              children: \"Seleccione el tipo de denuncia\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 11\n            }, this), data.complaintTypes.map(item => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: item,\n              children: item\n            }, item, false, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 44\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 5\n        }, this), errors.type && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ui negative message\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header\",\n            children: \"Debe seleccionar el tipo de denuncia\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"five fields\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Introduzca los datos que considere oportunos\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 3\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"field\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ...register(\"gender\"),\n            placeholder: \"G\\xE9nero\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 347,\n            columnNumber: 5\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"field\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ...register(\"discapacidad\"),\n            placeholder: \"Discapacidad\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 9\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"field\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ...register(\"etnia\"),\n            placeholder: \"Etnia\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 5\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"field\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ...register('age', {\n              valueAsNumber: true,\n              maxLength: 3\n            }),\n            placeholder: \"Edad\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 371,\n            columnNumber: 7\n          }, this), errors.age && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ui negative message\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"header\",\n              children: \" Debe escribir correctamente su edad\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 379,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 22\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"field\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ...register(\"religion\"),\n            placeholder: \"Religi\\xF3n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 383,\n          columnNumber: 5\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"required field\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Descripci\\xF3n del suceso\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 3\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", { ...register('text', {\n            required: true\n          }),\n          placeholder: \"Cu\\xE9ntanos tu historia\",\n          style: {\n            minHeight: 50\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 7\n        }, this), errors.text && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ui negative message\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header\",\n            children: \"Debe describir el suceso\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ui button\",\n        type: \"submit\",\n        children: \"Enviar denuncia\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Formulario, \"/6WQ4a5jhhKEwLvlOSaqZbt/3Yg=\", false, function () {\n  return [useForm];\n});\n\n_c = Formulario;\nexport default Formulario;\n\nvar _c;\n\n$RefreshReg$(_c, \"Formulario\");","map":{"version":3,"sources":["/Users/Angelota/Library/Mobile Documents/com~apple~CloudDocs/Desktop/UCM/TFG INFOR/TFG FINAL/TFGI-Plataforma-blockchain-para-visualizar-la-reputacion-de-empresas-sobre-casos-de-discriminacion/cliente/src/views/pages/formulario/form.js"],"names":["React","useState","useContext","useEffect","context","Web3","ReputationControl","useForm","data","swal","Swal","axios","create","ipfsHttpClient","Box","Button","Typography","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","client","Formulario","handleSubmit","register","formState","errors","isSubmitting","isSubmitSuccessful","companies","setCompanies","open","setOpen","Context","hash","contract","methods","getCompaniesNames","call","then","response","handleClickOpen","handleClose","formatoFecha","fecha","formato","map","dd","getDate","mm","getMonth","yy","getFullYear","toString","slice","yyyy","replace","matched","newComplaint","transaction","tx","to","process","env","REACT_APP_CONTRACT_ADDRESS","encodeABI","gas","estimateGas","from","REACT_APP_ADDRESS","gasPrice","web3","eth","getGasPrice","gaslimit","value","console","log","signedTx","accounts","signTransaction","REACT_APP_ETH_PRIVATE_KEY","sendSignedTransaction","rawTransaction","submitForm","e","preventDefault","user","title","text","icon","button","Date","toLocaleDateString","date","fire","timer","timerProgressBar","didOpen","showLoading","gender","toLowerCase","age","parseInt","rangeAge","Number","isNaN","relation","complaintJson","type","etnia","previousComplaints","media","add","JSON","stringify","company","path","complaintBBDD","post","REACT_APP_SERVER_URL","withCredentials","window","location","href","err","message","target","reset","validate","item","relations","months","valueAsNumber","maxLength","minLength","year","complaintTypes","required","minHeight"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from \"react\";\nimport { context } from '../../../contextProvider.js';\nimport Web3 from 'web3';\nimport ReputationControl from '../../../ReputationControl.json';\nimport { useForm } from 'react-hook-form';\nimport * as data from './constantData';\nimport swal from 'sweetalert';\nimport Swal from 'sweetalert2';\nimport axios from 'axios';\nimport { create as ipfsHttpClient } from \"ipfs-http-client\";\nimport {Box, Button, Typography} from '@mui/material';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogContentText from '@mui/material/DialogContentText';\nimport DialogTitle from '@mui/material/DialogTitle';\n\nconst client = ipfsHttpClient(\"https://ipfs.infura.io:5001/api/v0\");\n\n\nconst Formulario = () => {\n\n  const { handleSubmit, register, formState: { errors, isSubmitting, isSubmitSuccessful }} = useForm(/*{ shouldUnregister : true}*/);\n  const [companies, setCompanies] = useState([]);\n  const [open, setOpen] = useState(true);\n\n  const Context = React.useContext(context);\n  let hash = \"\";\n\n  useEffect(()=>{\n    Context.contract.methods.getCompaniesNames().call().then(response => setCompanies(response));\n  },[])\n\n  const handleClickOpen = () => {\n    setOpen(true);\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n\n\n  //Obtener la fecha actual\n  function formatoFecha(fecha, formato) {\n    const map = {\n        dd: fecha.getDate(),\n        mm: fecha.getMonth() + 1,\n        yy: fecha.getFullYear().toString().slice(-2),\n        yyyy: fecha.getFullYear()\n    }\n    return formato.replace(/dd|mm|yy|yyy/gi, matched => map[matched])\n  }\n  \n\n  //Función para realizar la transaccion al recibir los parametros\n  async function newComplaint(transaction) {\n      const tx = {\n          to      : process.env.REACT_APP_CONTRACT_ADDRESS, //Dirección del contrato\n          data    : transaction.encodeABI(),      //\n          gas     : await transaction.estimateGas({from: process.env.REACT_APP_ADDRESS}),   //Se estima el coste en gas\n          gasPrice: await Context.web3.eth.getGasPrice(),   //Precio del gas\n          gaslimit: 0x1000000,   //Limite de gas que se puede gastar\n          value   : 0,   //No se va a realizar una transferencia\n      };\n      console.log(\"transacción construida\");\n      //Se firma la transacción con la clave privada\n      const signedTx  = await Context.web3.eth.accounts.signTransaction(tx, process.env.REACT_APP_ETH_PRIVATE_KEY);\n      console.log(\"transacción firmada\");\n      //Se envia la transaccion firmada \n      await Context.web3.eth.sendSignedTransaction(signedTx.rawTransaction);\n  }\n\n\n  const submitForm = async (data,e) => {\n    e.preventDefault();\n\n    //Comprobar que el usuario esta conectado a linkedin\n    if(!Context.user){\n      console.log(\"El usuario no está conectado\");\n      swal({\n        title: \"ERROR\",\n        text: \"¡Debes estar conectado para enviar una denuncia!\",\n        icon: \"error\",\n        button: \"Aceptar\"\n      });\n    }\n\n    else{\n      //Obtener fecha\n      const fecha = new Date();\n      fecha.toLocaleDateString();\n      const date = formatoFecha(fecha, 'dd/mm/yy');\n\n      Swal.fire({\n        title: 'La denuncia está siendo cargada en la blockchain',\n        timer: 1000000,\n        timerProgressBar: false,\n        didOpen: () => {\n          Swal.showLoading()\n        }\n      });\n      \n      //Añadir datos a la bbdd para graficas generales\n      let gender = data.gender.toLowerCase()\n\n      if(gender == \"hombre\" || gender == \"masculino\")\n        gender = \"masculino\"\n      else if(gender == \"mujer\" || gender == \"femenino\")\n        gender = \"femenino\"\n      else if(gender == \"\")\n        gender = \"prefiero no responder\"\n      else gender = \"otro\" //Faltaria comprobar que en el genero se cometan errores ortograficos\n\n      let age = parseInt(data.age)\n      let rangeAge;\n      if(Number.isNaN(data.age))\n        rangeAge = \"prefiero no responder\"\n      else if(age>=81)\n        rangeAge = \"más de 80\"\n      else if(age>=71)\n        rangeAge = \"71-80\"\n      else if(age>=61)\n        rangeAge = \"61-70\"\n      else if(age>=51)\n        rangeAge = \"51-60\"\n      else if(age>=41)\n        rangeAge = \"41-50\"\n      else if(age>=31)\n        rangeAge = \"31-40\"\n      else if(age>=21)\n        rangeAge = \"21-30\"\n      else\n        rangeAge = \"16-21\"\n\n        console.log(data.relation);\n        \n        let complaintJson = \n        {\n          \"text\": data.text,\n          \"date\": date,\n          \"type\": data.type.toLowerCase(),\n          \"etnia\": data.etnia,\n          \"gender\": gender,\n          \"age\": rangeAge,\n          \"relation\": data.relation.toLowerCase(),\n          \"previousComplaints\": data.previousComplaints !== null ? data.previousComplaints : \"-\",\n          \"media\" : data.media,\n        }\n\n      hash = await client.add(JSON.stringify(complaintJson));\n      \n      //Relizar la denuncia\n      try{\n        await newComplaint(Context.contract.methods.newComplaint(data.company, hash.path));\n        \n        let complaintBBDD = {\n          \"type\": data.type.toLowerCase(),\n          \"gender\": gender,\n          \"age\": rangeAge,\n          \"relation\": data.relation.toLowerCase()\n        }\n  \n        //Enviar datos de denuncia a BBDD para gráficas\n        axios.post(`${process.env.REACT_APP_SERVER_URL}/charts`, complaintBBDD, { withCredentials : true})\n        \n        Swal.fire({\n          title: \"Denuncia cargada\",\n          text: \"La denuncia ya ha sido registrada en la blockchain\",\n          icon: \"success\",\n          timer: \"10000\"\n        }).then(function () {//Volver a la pagina principal\n          window.location.href = `http://localhost:3000`;\n        });  \n      \n      }\n      catch(err){\n        console.log(err.message);\n        swal({\n          title: \"ERROR\",\n          text: \"Algo ha ido mal a la hora de subir la denuncia a la blockchain. Vuelva a intentarlo más tarde\",\n          icon: \"error\",\n          button: \"Aceptar\"\n        });\n      }\n      \n      \n      \n      //Restaurar estado del formulario\n      e.target.reset();\n    }\n  }\n\n\n  return(\n    <>\n    <Dialog open={open} \n        onClose={handleClose} \n        aria-labelledby=\"alert-dialog-title\"\n        aria-describedby=\"alert-dialog-description\"\n    >\n        <DialogTitle id=\"alert-dialog-title\">\n          <Typography variant = \"h3\">\n            Formulario de denuncia\n          </Typography>\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"alert-dialog-description\">\n            <Typography variant = \"h5\">\n            Recuerde que todos los datos incluídos se almacenan en la blockchain y en IPFS, un sistema de ficheros descentralizado. \n            Por tanto, son de caracter público. Debe seleccionar obligatoriamente la empresa, su situación actual con dicha compañía, \n            el tipo de denuncía y la descripción del suceso. Es libre de introducir el resto de datos que considere oportuno. Además, se utilizarán para elaborar las gráficas de la aplicación\n            </Typography>\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleClose} autoFocus>Ok</Button>\n        </DialogActions>\n    </Dialog>\n\n    <form className=\"ui form\" onSubmit = {handleSubmit(submitForm)}>\n    <h1 className=\"ui dividing header\">Formulario de Denuncia</h1>\n    <div className=\"field\">\n      <div className=\"two fields\">\n\n        {/*Nombre empresa*/}\n        <div className=\"required field\">\n          <label>Nombre de la empresa</label>\n          <select\n            className=\"ui fluid selection dropdown\"\n            {...register(\"company\", {\n              validate : value => value !== \"Seleccione la empresa\"\n            })}>\n              <option hidden>Seleccione la empresa</option>\n              {companies.map(item => <option value={item} key={item}>{item}</option>)}\n          </select>\n          {errors.company && <div className = \"ui negative message\">\n                    <div className = \"header\">Debe seleccionar la empresa</div></div>}\n        </div>\n        \n        \n        {/*Relación con empresa*/}\n        <div className=\"required field\">\n          <label>Relación actual con la empresa</label>\n          <select \n            className=\"ui fluid selection dropdown\" \n            {...register(\"relation\", {\n              validate : value => value !== \"Seleccione la relación actual con la empresa\"\n            })}>\n              <option hidden>Seleccione la relación actual con la empresa</option>\n              {data.relations.map(item => <option value={item} key={item}>{item}</option>)}\n          </select>\n          {errors.relation && <div className = \"ui negative message\">\n                    <div className = \"header\">Debe seleccionar la relación actual con la empresa</div></div>}\n        </div>\n      </div>\n    </div>\n\n\n    <div className=\"three fields\">\n\n      {/*Denunciado antes*/}\n      <div className=\"inline fields\">\n        <label>¿Has denunciado anteriormente?</label>\n        <div className=\"field\">\n          <div className=\"ui radio checkbox\">\n            <input \n              type=\"radio\"\n              {...register(\"previousComplaints\")}\n              value = {true}/>\n            <label>Sí</label>\n          </div>\n        </div>\n\n        <div className=\"field\">\n          <div className=\"ui radio checkbox\">\n            <input \n              type=\"radio\"\n              {...register(\"previousComplaints\")}\n              value = {false}/>\n            <label>No</label>\n          </div>\n        </div>\n      </div>\n\n      {/*Mediante que medio denunciaste*/}\n      <div className=\"field\">\n        <label>Medio</label>\n        <input \n          type=\"text\"\n          {...register(\"media\")} \n          placeholder=\"En caso afirmativo, ¿mediante qué medio?\"/>\n      </div>\n\n      {/*Fecha del suceso*/}\n      <div className=\"field\">\n      <label>Fecha aproximada del suceso o del inicio de este</label>\n      <div className=\"two fields\">\n        <div className=\"field\">\n          <select \n            className=\"ui fluid search dropdown\" \n            {...register(\"month\")} >\n              <option hidden>Seleccione el mes</option>\n              {data.months.map(item => <option value={item} key={item}>{item}</option>)}\n          </select>\n        </div>\n\n        <div className=\"field\">\n          <input \n            type=\"text\"\n            {... register('year', {\n              valueAsNumber : true,\n              maxLength : 4,\n              minLength : 4\n            })}  \n            placeholder=\"Año\"/>\n          {errors.year && <div className = \"ui negative message\">\n                    <div className = \"header\"> Debe escribir correctamente el año</div></div>}\n        </div>\n      </div>\n      </div>\n    </div>\n      \n  <div className=\"field\">      \n    {/*Tipo de denuncia*/}\n    <div className=\"required field\">\n      <label>Tipo de denuncia</label>\n      <select \n        className=\"ui fluid dropdown\"\n        {...register('type', {\n          validate : value => value !== \"Seleccione el tipo de denuncia\"\n        })}>\n          <option hidden>Seleccione el tipo de denuncia</option>\n          {data.complaintTypes.map(item => <option value={item} key={item}>{item}</option>)}\n      </select>\n    </div>\n    {errors.type && <div className = \"ui negative message\">\n                    <div className = \"header\">Debe seleccionar el tipo de denuncia</div></div>}\n  </div>\n  \n\n\n  {/*El usuario deberá solo responder obligatoriamente a aquella relacionada con su tipo de denuncia. El resto son opcionales*/}\n  <div className=\"five fields\">\n  <label>Introduzca los datos que considere oportunos</label>\n    {/*Género*/}\n    <div className=\"field\">\n    <input \n          type=\"text\"\n          {...register(\"gender\")} \n          placeholder=\"Género\"/>\n    </div>\n\n    {/*Discapacidad*/}\n    <div className=\"field\">\n        <input \n          type=\"text\"\n          {...register(\"discapacidad\")}\n          placeholder=\"Discapacidad\"/>\n    </div>\n\n    {/*País*/}\n    <div className=\"field\">\n    <input \n          type=\"text\"\n          {...register(\"etnia\")} \n          placeholder=\"Etnia\"/>\n    </div>\n\n    {/*Edad*/}\n    <div className=\"field\">\n      <input \n        type=\"text\"\n        {... register('age', {\n          valueAsNumber : true,\n          maxLength : 3\n        })} \n        placeholder=\"Edad\"/>\n      {errors.age && <div className = \"ui negative message\">\n                    <div className = \"header\"> Debe escribir correctamente su edad</div></div>}\n    </div>\n\n    {/*Religión*/}\n    <div className=\"field\">\n      <input \n        type=\"text\"\n        {...register(\"religion\")} \n        placeholder=\"Religión\"/>\n    </div>\n  </div>    \n\n  {/*El usuario contará su historia*/} \n  <div className=\"required field\">\n  <label >Descripción del suceso</label>\n      <textarea  \n        {...register('text', {\n          required : true,\n        })}\n        placeholder=\"Cuéntanos tu historia\"\n        style={{ minHeight: 50 }}/>\n  {errors.text && <div className = \"ui negative message\">\n                    <div className = \"header\">Debe describir el suceso</div></div>}\n  </div>\n\n    {/*Botón para permitir compartir la historia. No es obligatorio para el usuario\n    <div className=\"ui segment\">\n      <div className=\"field\">\n        <div className=\"ui checkbox\">\n          <input \n            type=\"checkbox\"\n            {...register(\"consent\")}/>\n          <label>Acepto que mi historia aparezca publicada de forma anónima</label>\n        </div>\n      </div>\n    </div>\n    \n    \n    \n      */}\n    <button className = \"ui button\" type = \"submit\">Enviar denuncia</button>\n  </form>\n  </>\n  );\n};\nexport default Formulario;\n"]},"metadata":{},"sourceType":"module"}