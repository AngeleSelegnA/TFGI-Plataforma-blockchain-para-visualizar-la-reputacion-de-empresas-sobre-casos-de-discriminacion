{"ast":null,"code":"var _jsxFileName = \"/Users/Angelota/Library/Mobile Documents/com~apple~CloudDocs/Desktop/UCM/TFG INFOR/TFG FINAL/TFGI-Plataforma-blockchain-para-visualizar-la-reputacion-de-empresas-sobre-casos-de-discriminacion/cliente/src/views/dashboard/Default/index.js\",\n    _s = $RefreshSig$();\n\n// prettier-ignore\t\nimport React, { useEffect, useState, useContext } from 'react';\nimport { context } from '../../../contextProvider.js';\nimport { ethers } from \"ethers\";\nimport Joyride, { STATUS } from 'react-joyride';\nimport { steps } from \"../../utilities/Steps\";\nimport axios from 'axios'; // material-ui\n\nimport { Grid } from '@mui/material';\nimport { CardGroup } from 'semantic-ui-react';\nimport 'semantic-ui-css/semantic.min.css'; // project imports\n\nimport TarjetPrincipal from './TarjetPrincipal';\nimport RankingCard from './RankingCard';\nimport TotalIncomeDarkCard from './TotalIncomeDarkCard';\nimport TarjetaInfo from './TarjetaInfo';\nimport { gridSpacing } from 'store/constant';\nimport CompanyItem from './CompanyItem';\nimport Carousel, { Divider } from 'semantic-ui-carousel-react';\nimport DataGraphics from './DataGraphics.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Dashboard = () => {\n  _s();\n\n  const [balance, setBalance] = useState([]);\n  const [isLoading, setLoading] = useState(true);\n  const [notDone, setnotDone] = useState(true);\n  const [elements, setElements] = useState([]);\n  const [companiesAndReputations, setCompaniesAndReputations] = useState([]);\n  const Context = React.useContext(context); //window.localStorage.setItem('notDone', true)\n\n  if (localStorage.getItem('notDone') == 'false') {\n    localStorage.setItem('notDone', 'false');\n  } else {\n    localStorage.setItem('notDone', 'true');\n  } //Calcular todas las reputaciones, tras haber obtenido las nuestras.\n\n\n  function buildReputations(companies, reputations, totalComplaints) {\n    return new Promise((resolve, reject) => {\n      let j = 3;\n\n      if (totalComplaints < companies.length) {\n        j = 0;\n      } else if (totalComplaints < 3 * companies.length) {\n        j = 1;\n      } else if (totalComplaints < 5 * companies.length) {\n        j = 2;\n      }\n\n      let aux = Promise.all(companies.map(async (company, index) => {\n        const metrics = await axios.get(`${process.env.REACT_APP_SERVER_URL}/getMetrics/${company.toLowerCase()}`, {\n          withCredentials: true\n        });\n        var result = 0;\n        metrics.data.map(elem => {\n          result += elem * Context.pesos[j][0];\n        }); //result += (Context.pesos[j][1] * (10 - 0.01*reputations[index]));\n\n        result += Context.pesos[j][1] * (5 * Math.exp(-reputations[index] / 20) + 5 * (1 - reputations[index] / totalComplaints));\n        return [company, result.toFixed(2)];\n      }));\n      resolve(aux);\n    });\n  }\n\n  useEffect(async () => {\n    setLoading(false);\n    const [companies, ourReputations, totalComplaints] = await Promise.all([//Practicamente instantaneo(son gets)\n    await Context.contract.methods.getCompaniesNames().call(), await Context.contract.methods.getAllReputations().call(), await Context.contract.methods.getTotalComplaints().call()]);\n    const cards = await buildReputations(companies, ourReputations, totalComplaints);\n    console.log(\"cards\");\n    const ndiv = 4;\n    const nGroups = Math.floor(companies.length / ndiv);\n    const rest = companies.length % ndiv;\n    let aux = [];\n\n    for (let i = 0; i < nGroups; ++i) {\n      aux.push({\n        render: () => {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ui four column grid\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"row\",\n              children: /*#__PURE__*/_jsxDEV(CardGroup, {\n                itemsPerRow: ndiv,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"column\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 92,\n                  columnNumber: 25\n                }, this), cards.slice(ndiv * i, ndiv * (i + 1)).map(item => /*#__PURE__*/_jsxDEV(CompanyItem, {\n                  name: item[0],\n                  reputation: item[1]\n                }, item[0], false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 94,\n                  columnNumber: 33\n                }, this))]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 91,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 90,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 21\n          }, this);\n        }\n      });\n    }\n\n    if (rest > 0) {\n      aux.push({\n        render: () => {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ui four column grid\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"row\",\n              children: /*#__PURE__*/_jsxDEV(CardGroup, {\n                itemsPerRow: rest,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"column\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 108,\n                  columnNumber: 21\n                }, this), cards.slice(ndiv * nGroups, ndiv * nGroups + rest).map(item => /*#__PURE__*/_jsxDEV(CompanyItem, {\n                  name: item[0],\n                  reputation: item[1]\n                }, item[0], false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 110,\n                  columnNumber: 25\n                }, this))]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 107,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 106,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 17\n          }, this);\n        }\n      });\n    }\n\n    setElements(aux);\n    setCompaniesAndReputations(cards);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Joyride, {\n      continuous: true,\n      callback: data => {\n        const {\n          status\n        } = data;\n\n        if ([STATUS.FINISHED].includes(status) || [STATUS.SKIPPED].includes(status)) {\n          localStorage.setItem('notDone', 'false');\n          setnotDone(false);\n        }\n      },\n      scrollToFirstStep: true //el botoncito\n      ,\n      showProgress: true,\n      showSkipButton: true,\n      run: localStorage.getItem('notDone') == 'true' ? true : false,\n      steps: steps,\n      styles: {\n        buttonClose: {\n          display: 'none'\n        },\n        options: {\n          zIndex: 10000,\n          primaryColor: '#099'\n        }\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 15\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: gridSpacing,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          spacing: gridSpacing,\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            lg: 8,\n            md: 6,\n            sm: 6,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(TarjetPrincipal, {\n              isLoading: isLoading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            lg: 4,\n            md: 12,\n            sm: 12,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 1.5,\n              children: [/*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                sm: 6,\n                xs: 12,\n                md: 6,\n                lg: 12,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"denunciar\",\n                  children: /*#__PURE__*/_jsxDEV(TotalIncomeDarkCard, {\n                    isLoading: isLoading\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 165,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 164,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 163,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                sm: 6,\n                xs: 12,\n                md: 6,\n                lg: 12,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"informacion\",\n                  children: /*#__PURE__*/_jsxDEV(TarjetaInfo, {\n                    isLoading: isLoading\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 170,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 169,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 168,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          spacing: gridSpacing,\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            lg: 8,\n            md: 12,\n            sm: 12,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacin: gridSpacing,\n              children: [/*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                sm: 12,\n                xs: 12,\n                md: 6,\n                lg: 12,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"empresa\",\n                  children: /*#__PURE__*/_jsxDEV(Carousel, {\n                    isLoading: isLoading,\n                    elements: elements,\n                    duration: 6000,\n                    animation: \"slide left\",\n                    showNextPrev: false,\n                    showIndicators: true,\n                    margin: \"1.5\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 186,\n                    columnNumber: 33\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 185,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                sm: 4,\n                xs: 12,\n                md: 6,\n                lg: 12,\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 201,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 202,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 203,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(DataGraphics, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 204,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 183,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            lg: 4,\n            md: 12,\n            sm: 12,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(RankingCard, {\n              isLoading: isLoading,\n              cr: companiesAndReputations\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Dashboard, \"nisOv6oYRLfsrbvTFWL+EBKoOPs=\");\n\n_c = Dashboard;\nexport default Dashboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"sources":["/Users/Angelota/Library/Mobile Documents/com~apple~CloudDocs/Desktop/UCM/TFG INFOR/TFG FINAL/TFGI-Plataforma-blockchain-para-visualizar-la-reputacion-de-empresas-sobre-casos-de-discriminacion/cliente/src/views/dashboard/Default/index.js"],"names":["React","useEffect","useState","useContext","context","ethers","Joyride","STATUS","steps","axios","Grid","CardGroup","TarjetPrincipal","RankingCard","TotalIncomeDarkCard","TarjetaInfo","gridSpacing","CompanyItem","Carousel","Divider","DataGraphics","Dashboard","balance","setBalance","isLoading","setLoading","notDone","setnotDone","elements","setElements","companiesAndReputations","setCompaniesAndReputations","Context","localStorage","getItem","setItem","buildReputations","companies","reputations","totalComplaints","Promise","resolve","reject","j","length","aux","all","map","company","index","metrics","get","process","env","REACT_APP_SERVER_URL","toLowerCase","withCredentials","result","data","elem","pesos","Math","exp","toFixed","ourReputations","contract","methods","getCompaniesNames","call","getAllReputations","getTotalComplaints","cards","console","log","ndiv","nGroups","floor","rest","i","push","render","slice","item","status","FINISHED","includes","SKIPPED","buttonClose","display","options","zIndex","primaryColor"],"mappings":"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","sourcesContent":["// prettier-ignore\t\r\nimport React, {  useEffect, useState, useContext } from 'react';\r\nimport { context } from '../../../contextProvider.js';\r\nimport { ethers } from \"ethers\";\r\nimport Joyride, {  STATUS } from 'react-joyride';\r\nimport { steps } from \"../../utilities/Steps\";\r\nimport axios from 'axios';\r\n\r\n// material-ui\r\nimport { Grid } from '@mui/material';\r\nimport {CardGroup } from 'semantic-ui-react';\r\n\r\nimport 'semantic-ui-css/semantic.min.css';\r\n\r\n// project imports\r\nimport TarjetPrincipal from './TarjetPrincipal';\r\nimport RankingCard from './RankingCard';\r\nimport TotalIncomeDarkCard from './TotalIncomeDarkCard';\r\nimport TarjetaInfo from './TarjetaInfo';\r\nimport { gridSpacing } from 'store/constant';\r\nimport CompanyItem from './CompanyItem';\r\nimport Carousel, { Divider } from 'semantic-ui-carousel-react';\r\nimport DataGraphics from './DataGraphics.js'\r\n\r\nconst Dashboard = () => {\r\n\r\n    const [balance, setBalance] = useState([]);\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [notDone, setnotDone] = useState(true);\r\n    const [elements, setElements] = useState([]);\r\n    const [companiesAndReputations, setCompaniesAndReputations] = useState([]);\r\n\r\n    const Context = React.useContext(context);\r\n\r\n    //window.localStorage.setItem('notDone', true)\r\n    if(localStorage.getItem('notDone') == 'false'){\r\n        localStorage.setItem('notDone','false');\r\n    }\r\n    else {localStorage.setItem('notDone', 'true')}\r\n\r\n    //Calcular todas las reputaciones, tras haber obtenido las nuestras.\r\n    function buildReputations(companies, reputations, totalComplaints){\r\n        return new Promise((resolve,reject) =>{\r\n            let j = 3;\r\n            if(totalComplaints < companies.length){\r\n                j = 0;\r\n            }\r\n            else if (totalComplaints < 3*companies.length){\r\n                j = 1;\r\n            }\r\n            else if(totalComplaints < 5*companies.length){\r\n                j = 2;\r\n            }\r\n\r\n            let aux = Promise.all(\r\n                companies.map(async (company, index) =>{\r\n                    const metrics = await axios.get(`${process.env.REACT_APP_SERVER_URL}/getMetrics/${company.toLowerCase()}`, { withCredentials : true});\r\n                    var result = 0;\r\n                    metrics.data.map((elem) => {result += (elem * Context.pesos[j][0])});\r\n                    //result += (Context.pesos[j][1] * (10 - 0.01*reputations[index]));\r\n                    result += (Context.pesos[j][1] * ((5*(Math.exp(-reputations[index]/20)) + 5*(1-reputations[index]/totalComplaints))));\r\n                    return [company,result.toFixed(2)];\r\n                })\r\n\r\n            )\r\n            resolve(aux);\r\n        });\r\n    }\r\n\r\n    useEffect(async () => {\r\n        setLoading(false);\r\n        const [companies, ourReputations, totalComplaints] = await Promise.all([ //Practicamente instantaneo(son gets)\r\n            await Context.contract.methods.getCompaniesNames().call(),\r\n            await Context.contract.methods.getAllReputations().call(),\r\n            await Context.contract.methods.getTotalComplaints().call()\r\n        ]); \r\n        \r\n\r\n        const cards = await buildReputations(companies, ourReputations, totalComplaints);\r\n        console.log(\"cards\");\r\n        const ndiv = 4;\r\n        const nGroups = Math.floor(companies.length/ndiv);\r\n        const rest = companies.length%ndiv;\r\n        let aux = [];\r\n\r\n        for(let i = 0; i < nGroups; ++i){\r\n            aux.push( {render:() =>{\r\n                return (\r\n                    <div className=\"ui four column grid\">\r\n                    <div className=\"row\">\r\n                        <CardGroup itemsPerRow={ndiv}>\r\n                        <div className=\"column\"></div>\r\n                        {cards.slice(ndiv*i,ndiv*(i+1)).map((item) =>\r\n                                <CompanyItem key={item[0]} name={item[0]} reputation={item[1]}/>\r\n                        )}\r\n                        </CardGroup>\r\n                    </div>\r\n                    </div>\r\n                )}\r\n            });\r\n        }\r\n        if(rest>0){\r\n            aux.push({render:() =>{\r\n                return (\r\n                <div className=\"ui four column grid\">\r\n                <div className=\"row\">\r\n                    <CardGroup itemsPerRow={rest}>\r\n                    <div className=\"column\"></div>\r\n                    {cards.slice(ndiv*nGroups, ndiv*nGroups + rest).map((item)=>\r\n                        <CompanyItem key={item[0]} name={item[0]} reputation={item[1]}/>\r\n                    )}\r\n                    </CardGroup>\r\n                </div>\r\n                </div> )}});\r\n        }\r\n        setElements(aux);\r\n        setCompaniesAndReputations(cards);\r\n    }, []);\r\n\r\n\r\n    return (\r\n        <div>\r\n              <Joyride\r\n                continuous={true}  \r\n                callback={(data) => {\r\n                    const { status } = data;\r\n\r\n                    if ([STATUS.FINISHED].includes(status) || [STATUS.SKIPPED].includes(status)) {\r\n                        localStorage.setItem('notDone', 'false');\r\n                        setnotDone(false);\r\n                    } \r\n                    \r\n                }} \r\n                scrollToFirstStep={true} //el botoncito\r\n                showProgress={true}\r\n                showSkipButton={true}\r\n                run = {localStorage.getItem('notDone') == 'true' ? (true):(false)}\r\n                steps={steps}\r\n                styles={{\r\n                    \r\n                    buttonClose: {\r\n                        display: 'none',\r\n                    },\r\n                    options: {\r\n                        zIndex: 10000,\r\n                        primaryColor: '#099',\r\n                      },\r\n                }}\r\n            />\r\n        <Grid container spacing={gridSpacing}>\r\n            {/* fila 1: titulo + donar + recaudado */}\r\n            <Grid item xs={12}>\r\n                <Grid container spacing={gridSpacing}>\r\n\r\n                    {/* columna 1 de 12 ocupa 8 (mas ancha)*/}\r\n                    <Grid item lg={8} md={6} sm={6} xs={12}>\r\n                        <TarjetPrincipal isLoading={isLoading} />\r\n                    </Grid>\r\n\r\n                    {/* columna 2= tarjetas peq*/}\r\n                    <Grid item lg={4} md={12} sm={12} xs={12}>\r\n                        <Grid container spacing={1.5}>\r\n                            <Grid item sm={6} xs={12} md={6} lg={12}>\r\n                                <div className = \"denunciar\">\r\n                                    <TotalIncomeDarkCard isLoading={isLoading} />\r\n                                </div>\r\n                            </Grid>\r\n                            <Grid item sm={6} xs={12} md={6} lg={12}> \r\n                                <div className=\"informacion\">\r\n                                    <TarjetaInfo isLoading={isLoading}/>  \r\n                                </div>\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Grid>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            {/* fila 2*/}\r\n            <Grid item xs={12}>\r\n                <Grid container spacing={gridSpacing}>\r\n                    {/* columna 1= carousel+ graf*/}\r\n                    <Grid item lg={8} md={12} sm={12} xs={12}>\r\n                        <Grid container spacin={gridSpacing}>\r\n                            <Grid item sm={12} xs={12} md={6} lg={12}>\r\n                            <div className = \"empresa\">\r\n                                <Carousel \r\n                                isLoading={isLoading}\r\n                                elements = {elements}\r\n                                duration ={6000}\r\n                                animation = 'slide left'\r\n                                showNextPrev = {false}\r\n                                showIndicators = {true}  \r\n                                margin=\"1.5\"\r\n\r\n                                />\r\n                            </div>\r\n                            \r\n                            </Grid>\r\n                       \r\n                            <Grid item sm={4} xs={12} md={6} lg={12}>\r\n                                <p></p>\r\n                                <p></p>\r\n                                <p></p>\r\n                                <DataGraphics /> \r\n                            </Grid>\r\n                        \r\n                        </Grid>\r\n                    </Grid>\r\n                  \r\n                    <Grid item lg={4} md={12} sm={12} xs={12}>\r\n                        <RankingCard isLoading={isLoading} cr = {companiesAndReputations}/>\r\n                    </Grid>\r\n                </Grid>\r\n\r\n            </Grid>\r\n        </Grid>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Dashboard;\r\n"]},"metadata":{},"sourceType":"module"}